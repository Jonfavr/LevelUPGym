<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LevelUp Gym â€” Check-In</title>
    <link rel="icon" type="image/x-icon" href="/static/image/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root {
            --bg-base:       #0b0d14;
            --bg-surface:    #12151f;
            --bg-elevated:   #1a1e2e;
            --bg-hover:      #212540;
            --accent:        #667eea;
            --accent-glow:   rgba(102,126,234,0.25);
            --accent-2:      #764ba2;
            --emerald:       #10b981;
            --emerald-glow:  rgba(16,185,129,0.15);
            --amber:         #fbbf24;
            --red:           #ef4444;
            --red-glow:      rgba(239,68,68,0.15);
            --text-primary:  #f0f2ff;
            --text-secondary:#8b8fa8;
            --text-muted:    #555975;
            --border:        rgba(255,255,255,0.06);
            --border-accent: rgba(102,126,234,0.35);
            --radius-sm:     8px;
            --radius-md:     12px;
            --radius-lg:     20px;
            --warrior:  #ef4444;
            --ranger:   #10b981;
            --tank:     #3b82f6;
            --assassin: #a855f7;
            --mage:     #fbbf24;
        }

        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
        html, body { width:100vw; height:100vh; overflow:hidden; background:var(--bg-base); color:var(--text-primary); font-family:'DM Sans',sans-serif; }

        body::before {
            content:''; position:fixed; inset:0;
            background-image: linear-gradient(rgba(102,126,234,0.03) 1px,transparent 1px), linear-gradient(90deg,rgba(102,126,234,0.03) 1px,transparent 1px);
            background-size:40px 40px; pointer-events:none; z-index:0;
        }
        body::after {
            content:''; position:fixed; top:-15vh; left:-10vw; width:60vw; height:60vh;
            background:radial-gradient(ellipse,rgba(102,126,234,0.07) 0%,transparent 70%);
            pointer-events:none; z-index:0;
        }

        .kiosk-wrap { position:relative; z-index:1; display:flex; flex-direction:column; width:100vw; height:100vh; }

        /* HEADER */
        .kiosk-header {
            display:flex; align-items:center; justify-content:space-between;
            padding:0 40px; height:72px;
            background:var(--bg-surface); border-bottom:1px solid var(--border); flex-shrink:0;
        }
        .kiosk-logo { display:flex; align-items:center; gap:14px; }
        .kiosk-logo img { height:40px; width:40px; border-radius:10px; object-fit:cover; }
        .kiosk-logo-text { font-family:'Rajdhani',sans-serif; font-size:22px; font-weight:900; letter-spacing:3px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .kiosk-logo-sub { font-size:11px; color:var(--text-muted); letter-spacing:2px; text-transform:uppercase; margin-top:-2px; }
        .kiosk-badge { display:flex; align-items:center; gap:8px; padding:8px 18px; background:var(--bg-elevated); border:1px solid var(--border-accent); border-radius:40px; font-family:'Rajdhani',sans-serif; font-size:14px; font-weight:700; letter-spacing:1px; color:var(--accent); }
        .kiosk-time { font-family:'Rajdhani',sans-serif; font-size:28px; font-weight:700; line-height:1; }
        .kiosk-date { font-size:11px; color:var(--text-muted); letter-spacing:1px; text-transform:uppercase; }
        .kiosk-clock { text-align:right; }

        /* BODY */
        .kiosk-body { flex:1; display:grid; grid-template-columns:1fr 1fr; overflow:hidden; }

        /* LEFT PANEL */
        .checkin-left { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:28px 36px; border-right:1px solid var(--border); gap:22px; }

        .step-header { text-align:center; }
        .step-label { font-size:11px; letter-spacing:3px; text-transform:uppercase; color:var(--text-muted); margin-bottom:4px; }
        .step-title { font-family:'Rajdhani',sans-serif; font-size:30px; font-weight:900; color:var(--text-primary); }
        .step-sub { font-size:13px; color:var(--text-secondary); margin-top:3px; }

        .numpad-display { width:100%; max-width:320px; height:62px; background:var(--bg-elevated); border:1.5px solid var(--border-accent); border-radius:var(--radius-md); display:flex; align-items:center; justify-content:center; font-family:'Rajdhani',sans-serif; font-size:22px; font-weight:700; color:var(--text-primary); letter-spacing:2px; transition:border-color 0.3s,box-shadow 0.3s; }
        .numpad-display.glow { border-color:var(--accent); box-shadow:0 0 20px var(--accent-glow); }
        .numpad-display.error { border-color:var(--red); box-shadow:0 0 20px var(--red-glow); animation:shake 0.4s ease; }
        .cursor { display:inline-block; width:2px; height:28px; background:var(--accent); margin-left:4px; animation:blink 1s step-end infinite; vertical-align:middle; }

        .pin-dots { display:flex; gap:16px; align-items:center; justify-content:center; }
        .pin-dot { width:20px; height:20px; border-radius:50%; border:2px solid var(--text-muted); background:transparent; transition:all 0.2s cubic-bezier(0.34,1.56,0.64,1); }
        .pin-dot.filled { background:var(--accent); border-color:var(--accent); box-shadow:0 0 12px var(--accent-glow); transform:scale(1.15); }
        .pin-dot.error { border-color:var(--red); background:var(--red); }

        .numpad-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:9px; width:100%; max-width:320px; }
        .numpad-key { height:64px; background:var(--bg-elevated); border:1px solid var(--border); border-radius:var(--radius-md); display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; user-select:none; transition:background 0.15s,border-color 0.15s,transform 0.1s; position:relative; overflow:hidden; }
        .numpad-key:hover { background:var(--bg-hover); border-color:var(--border-accent); }
        .numpad-key:active { transform:scale(0.93); }
        .numpad-key .key-digit { font-family:'Rajdhani',sans-serif; font-size:24px; font-weight:700; color:var(--text-primary); line-height:1; }
        .numpad-key .key-letters { font-size:8px; letter-spacing:2px; color:var(--text-muted); text-transform:uppercase; margin-top:1px; }
        .numpad-key.key-action { background:var(--bg-surface); }
        .numpad-key.key-action i { font-size:17px; color:var(--text-secondary); }
        .numpad-key.key-clear { background:rgba(239,68,68,0.08); border-color:rgba(239,68,68,0.2); }
        .numpad-key.key-clear i { color:var(--red); }
        .numpad-key::after { content:''; position:absolute; inset:0; background:radial-gradient(circle at center,rgba(102,126,234,0.2),transparent 70%); opacity:0; transform:scale(0.3); transition:opacity 0.3s,transform 0.4s; pointer-events:none; }
        .numpad-key.ripple::after { opacity:1; transform:scale(1.5); }

        .proceed-btn { width:100%; max-width:320px; height:52px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); border:none; border-radius:12px; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px; transition:filter 0.2s; }
        .proceed-btn:hover { filter:brightness(1.15); }
        .proceed-btn span { font-family:'Rajdhani',sans-serif; font-size:16px; font-weight:700; color:white; letter-spacing:1px; }
        .proceed-btn i { font-size:18px; color:white; }

        .step-indicator { display:flex; gap:8px; align-items:center; }
        .step-dot { width:8px; height:8px; border-radius:50%; background:var(--text-muted); transition:all 0.3s; }
        .step-dot.active { background:var(--accent); box-shadow:0 0 8px var(--accent-glow); width:24px; border-radius:4px; }
        .step-dot.done { background:var(--emerald); }

        .numpad-hint { font-size:13px; color:var(--text-muted); text-align:center; min-height:20px; }
        .numpad-hint.error { color:var(--red); }

        /* FLIP */
        .flip-scene { width:100%; max-width:380px; perspective:1200px; }
        .flip-card { width:100%; position:relative; transform-style:preserve-3d; transition:transform 0.65s cubic-bezier(0.4,0,0.2,1); }
        .flip-card.flipped { transform:rotateY(180deg); }
        .flip-face { width:100%; backface-visibility:hidden; -webkit-backface-visibility:hidden; }
        .flip-face-back { position:absolute; top:0; left:0; transform:rotateY(180deg); }

        /* CONFIRMED */
        .checkin-confirmed { display:none; flex-direction:column; align-items:center; gap:14px; text-align:center; }
        .checkin-confirmed.visible { display:flex; }
        .confirmed-icon { width:80px; height:80px; border-radius:50%; background:var(--emerald-glow); border:2px solid var(--emerald); display:flex; align-items:center; justify-content:center; font-size:34px; color:var(--emerald); box-shadow:0 0 40px rgba(16,185,129,0.3); animation:popIn 0.5s cubic-bezier(0.34,1.56,0.64,1); }
        .confirmed-title { font-family:'Rajdhani',sans-serif; font-size:34px; font-weight:900; color:var(--emerald); animation:fadeSlideUp 0.4s ease 0.15s both; }
        .confirmed-sub { font-size:15px; color:var(--text-secondary); animation:fadeSlideUp 0.4s ease 0.3s both; }
        .new-checkin-btn { margin-top:6px; padding:11px 26px; background:var(--bg-elevated); border:1px solid var(--border-accent); border-radius:40px; color:var(--accent); font-family:'Rajdhani',sans-serif; font-size:14px; font-weight:700; letter-spacing:1px; cursor:pointer; transition:all 0.2s; animation:fadeSlideUp 0.4s ease 0.45s both; }
        .new-checkin-btn:hover { background:var(--bg-hover); box-shadow:0 0 16px var(--accent-glow); }

        /* RIGHT PANEL */
        .checkin-right { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:36px 40px; gap:20px; position:relative; overflow:hidden; }
        .checkin-right::before { content:''; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:60%; height:60%; border-radius:50%; background:radial-gradient(ellipse,rgba(102,126,234,0.08) 0%,transparent 70%); pointer-events:none; opacity:0; transition:opacity 0.8s; }
        .checkin-right.lit::before { opacity:1; }

        .idle-state { display:flex; flex-direction:column; align-items:center; gap:18px; text-align:center; transition:opacity 0.4s,transform 0.4s; }
        .idle-state.hidden { opacity:0; transform:scale(0.92); pointer-events:none; position:absolute; }
        .idle-icon { width:100px; height:100px; border-radius:50%; background:var(--bg-elevated); border:1px dashed var(--border-accent); display:flex; align-items:center; justify-content:center; font-size:40px; color:var(--text-muted); animation:pulseRing 3s ease infinite; }
        .idle-title { font-family:'Rajdhani',sans-serif; font-size:26px; font-weight:700; color:var(--text-muted); }
        .idle-sub { font-size:14px; color:var(--text-muted); max-width:240px; }

        /* PROFILE CARD */
        .profile-card { width:100%; max-width:400px; opacity:0; transform:translateY(28px) scale(0.96); transition:opacity 0.55s ease,transform 0.55s cubic-bezier(0.34,1.2,0.64,1); pointer-events:none; }
        .profile-card.visible { opacity:1; transform:translateY(0) scale(1); pointer-events:auto; }
        .profile-chrome { background:var(--bg-surface); border:1px solid var(--border); border-radius:var(--radius-lg); overflow:hidden; box-shadow:0 24px 60px rgba(0,0,0,0.5); }

        .profile-banner { height:88px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); position:relative; }
        .profile-banner::after { content:''; position:absolute; inset:0; background:repeating-linear-gradient(45deg,transparent,transparent 20px,rgba(255,255,255,0.04) 20px,rgba(255,255,255,0.04) 40px); }
        .profile-banner-badge { position:absolute; top:12px; right:16px; font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; letter-spacing:2px; color:rgba(255,255,255,0.55); text-transform:uppercase; z-index:1; }

        .profile-avatar-wrap { position:relative; margin-top:-44px; display:flex; justify-content:center; z-index:2; }
        .profile-avatar { width:88px; height:88px; border-radius:50%; background:linear-gradient(135deg,var(--accent),var(--accent-2)); border:4px solid var(--bg-surface); display:flex; align-items:center; justify-content:center; font-family:'Rajdhani',sans-serif; font-size:36px; font-weight:900; color:white; box-shadow:0 8px 24px rgba(0,0,0,0.4); }
        .profile-avatar-ring { position:absolute; inset:-6px; border-radius:50%; border:2px solid transparent; }

        .profile-body { padding:10px 26px 26px; text-align:center; }
        .profile-name { font-family:'Rajdhani',sans-serif; font-size:28px; font-weight:900; color:var(--text-primary); letter-spacing:1px; }
        .profile-id { font-size:12px; color:var(--text-muted); margin-top:2px; margin-bottom:14px; letter-spacing:1px; }

        .profile-stats { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:18px; }
        .stat-cell { background:var(--bg-elevated); border:1px solid var(--border); border-radius:var(--radius-sm); padding:11px 6px; text-align:center; }
        .stat-val { font-family:'Rajdhani',sans-serif; font-size:20px; font-weight:900; color:var(--text-primary); }
        .stat-label { font-size:9px; letter-spacing:1.5px; text-transform:uppercase; color:var(--text-muted); margin-top:2px; }

        .xp-section { margin-bottom:16px; text-align:left; }
        .xp-top { display:flex; justify-content:space-between; font-size:12px; color:var(--text-muted); margin-bottom:6px; }
        .xp-track { height:8px; background:var(--bg-elevated); border-radius:4px; overflow:hidden; }
        .xp-fill { height:100%; background:linear-gradient(90deg,var(--accent),var(--accent-2)); border-radius:4px; transition:width 1.2s cubic-bezier(0.4,0,0.2,1); width:0%; }

        .class-badge { display:inline-flex; align-items:center; gap:8px; padding:7px 18px; border-radius:40px; font-family:'Rajdhani',sans-serif; font-size:15px; font-weight:700; letter-spacing:1px; margin-bottom:14px; }
        .class-badge i { font-size:13px; }
        .class-Warrior  { background:rgba(239,68,68,0.12);  color:var(--warrior);  border:1px solid rgba(239,68,68,0.3); }
        .class-Ranger   { background:rgba(16,185,129,0.12); color:var(--ranger);   border:1px solid rgba(16,185,129,0.3); }
        .class-Tank     { background:rgba(59,130,246,0.12); color:var(--tank);     border:1px solid rgba(59,130,246,0.3); }
        .class-Assassin { background:rgba(168,85,247,0.12); color:var(--assassin); border:1px solid rgba(168,85,247,0.3); }
        .class-Mage     { background:rgba(251,191,36,0.12); color:var(--mage);     border:1px solid rgba(251,191,36,0.3); }
        .class-none     { background:var(--bg-elevated); color:var(--text-muted); border:1px solid var(--border); }
        .ring-Warrior  { border-color:var(--warrior); }
        .ring-Ranger   { border-color:var(--ranger); }
        .ring-Tank     { border-color:var(--tank); }
        .ring-Assassin { border-color:var(--assassin); }
        .ring-Mage     { border-color:var(--mage); }

        .routine-card { background:var(--bg-elevated); border:1px solid var(--border); border-radius:var(--radius-md); padding:14px 18px; display:flex; align-items:center; gap:14px; text-align:left; }
        .routine-icon { width:42px; height:42px; flex-shrink:0; border-radius:var(--radius-sm); background:linear-gradient(135deg,var(--accent),var(--accent-2)); display:flex; align-items:center; justify-content:center; font-size:19px; color:white; }
        .routine-label { font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--text-muted); margin-bottom:3px; }
        .routine-name { font-family:'Rajdhani',sans-serif; font-size:17px; font-weight:700; color:var(--text-primary); }

        /* Spinner */
        .spinner { display:none; width:24px; height:24px; border:3px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin 0.7s linear infinite; }
        .spinner.visible { display:block; }

        .scanlines { position:fixed; inset:0; pointer-events:none; z-index:999; background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,0,0,0.04) 3px,rgba(0,0,0,0.04) 4px); }

        /* KEYFRAMES */
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
        @keyframes shake { 0%,100%{transform:translateX(0)} 20%,60%{transform:translateX(-8px)} 40%,80%{transform:translateX(8px)} }
        @keyframes popIn { from{transform:scale(0);opacity:0} to{transform:scale(1);opacity:1} }
        @keyframes fadeSlideUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
        @keyframes spin { to{transform:rotate(360deg)} }
        @keyframes pulseRing { 0%,100%{box-shadow:0 0 0 0 var(--accent-glow)} 50%{box-shadow:0 0 0 16px transparent} }
    </style>
</head>
<body>

<div class="scanlines"></div>

<div class="kiosk-wrap">

    <!-- HEADER -->
    <header class="kiosk-header">
        <div class="kiosk-logo">
            <img src="/static/image/levelup_gym_icon.svg" alt="LevelUp" onerror="this.style.display='none'">
            <div>
                <div class="kiosk-logo-text">LEVELUP</div>
                <div class="kiosk-logo-sub">Check-In Station</div>
            </div>
        </div>
        <div class="kiosk-badge"><i class="fa-solid fa-shield-halved"></i> MEMBER CHECK-IN</div>
        <div class="kiosk-clock">
            <div class="kiosk-time" id="clock-time">--:--</div>
            <div class="kiosk-date" id="clock-date">---</div>
        </div>
    </header>

    <!-- BODY -->
    <div class="kiosk-body">

        <!-- LEFT: Numpad -->
        <div class="checkin-left">

            <div class="step-indicator">
                <div class="step-dot active" id="dot-step-1"></div>
                <div class="step-dot"        id="dot-step-2"></div>
                <div class="step-dot"        id="dot-step-3"></div>
            </div>

            <!-- FLIP CARD -->
            <div class="flip-scene" id="flip-scene">
                <div class="flip-card" id="flip-card">

                    <!-- FRONT: Phone Number -->
                    <div class="flip-face">
                        <div style="display:flex;flex-direction:column;align-items:center;gap:18px;">
                            <div class="step-header">
                                <div class="step-label">Step 1 of 2</div>
                                <div class="step-title">Phone Number</div>
                                <div class="step-sub">Enter your registered phone number</div>
                            </div>

                            <div class="numpad-display" id="display-number">
                                <span id="display-number-text"><span class="cursor"></span></span>
                            </div>

                            <div class="numpad-grid">
                                <div class="numpad-key" data-step="number" data-val="1"><span class="key-digit">1</span></div>
                                <div class="numpad-key" data-step="number" data-val="2"><span class="key-digit">2</span><span class="key-letters">ABC</span></div>
                                <div class="numpad-key" data-step="number" data-val="3"><span class="key-digit">3</span><span class="key-letters">DEF</span></div>
                                <div class="numpad-key" data-step="number" data-val="4"><span class="key-digit">4</span><span class="key-letters">GHI</span></div>
                                <div class="numpad-key" data-step="number" data-val="5"><span class="key-digit">5</span><span class="key-letters">JKL</span></div>
                                <div class="numpad-key" data-step="number" data-val="6"><span class="key-digit">6</span><span class="key-letters">MNO</span></div>
                                <div class="numpad-key" data-step="number" data-val="7"><span class="key-digit">7</span><span class="key-letters">PQRS</span></div>
                                <div class="numpad-key" data-step="number" data-val="8"><span class="key-digit">8</span><span class="key-letters">TUV</span></div>
                                <div class="numpad-key" data-step="number" data-val="9"><span class="key-digit">9</span><span class="key-letters">WXYZ</span></div>
                                <div class="numpad-key key-action key-clear" data-step="number" data-val="clear"><i class="fa-solid fa-rotate-left"></i></div>
                                <div class="numpad-key" data-step="number" data-val="0"><span class="key-digit">0</span></div>
                                <div class="numpad-key key-action" data-step="number" data-val="delete"><i class="fa-solid fa-delete-left"></i></div>
                            </div>

                            <button class="proceed-btn" id="proceed-btn">
                                <i class="fa-solid fa-arrow-right"></i>
                                <span>CONTINUE TO PIN</span>
                            </button>

                            <div class="numpad-hint" id="hint-number">&nbsp;</div>
                        </div>
                    </div><!-- /front -->

                    <!-- BACK: PIN -->
                    <div class="flip-face flip-face-back">
                        <div style="display:flex;flex-direction:column;align-items:center;gap:18px;">
                            <div class="step-header">
                                <div class="step-label">Step 2 of 2</div>
                                <div class="step-title">Enter PIN</div>
                                <div class="step-sub" id="pin-member-hint">4-digit security code</div>
                            </div>

                            <div class="pin-dots">
                                <div class="pin-dot" id="pd-0"></div>
                                <div class="pin-dot" id="pd-1"></div>
                                <div class="pin-dot" id="pd-2"></div>
                                <div class="pin-dot" id="pd-3"></div>
                            </div>

                            <div class="numpad-grid">
                                <div class="numpad-key" data-step="pin" data-val="1"><span class="key-digit">1</span></div>
                                <div class="numpad-key" data-step="pin" data-val="2"><span class="key-digit">2</span><span class="key-letters">ABC</span></div>
                                <div class="numpad-key" data-step="pin" data-val="3"><span class="key-digit">3</span><span class="key-letters">DEF</span></div>
                                <div class="numpad-key" data-step="pin" data-val="4"><span class="key-digit">4</span><span class="key-letters">GHI</span></div>
                                <div class="numpad-key" data-step="pin" data-val="5"><span class="key-digit">5</span><span class="key-letters">JKL</span></div>
                                <div class="numpad-key" data-step="pin" data-val="6"><span class="key-digit">6</span><span class="key-letters">MNO</span></div>
                                <div class="numpad-key" data-step="pin" data-val="7"><span class="key-digit">7</span><span class="key-letters">PQRS</span></div>
                                <div class="numpad-key" data-step="pin" data-val="8"><span class="key-digit">8</span><span class="key-letters">TUV</span></div>
                                <div class="numpad-key" data-step="pin" data-val="9"><span class="key-digit">9</span><span class="key-letters">WXYZ</span></div>
                                <div class="numpad-key key-action key-clear" data-step="pin" data-val="back"><i class="fa-solid fa-chevron-left"></i></div>
                                <div class="numpad-key" data-step="pin" data-val="0"><span class="key-digit">0</span></div>
                                <div class="numpad-key key-action" data-step="pin" data-val="delete"><i class="fa-solid fa-delete-left"></i></div>
                            </div>

                            <div class="spinner" id="pin-spinner"></div>
                            <div class="numpad-hint" id="hint-pin">&nbsp;</div>
                        </div>
                    </div><!-- /back -->

                </div><!-- /flip-card -->
            </div><!-- /flip-scene -->

            <!-- CONFIRMED STATE -->
            <div class="checkin-confirmed" id="confirmed-state">
                <div class="confirmed-icon"><i class="fa-solid fa-check"></i></div>
                <div class="confirmed-title">Checked In!</div>
                <div class="confirmed-sub" id="confirmed-msg">Have a great workout ðŸ’ª</div>
                <button class="new-checkin-btn" id="new-checkin-btn">
                    <i class="fa-solid fa-rotate"></i>&nbsp; New Check-In
                </button>
            </div>

        </div><!-- /checkin-left -->

        <!-- RIGHT: Profile -->
        <div class="checkin-right" id="checkin-right">

            <div class="idle-state" id="idle-state">
                <div class="idle-icon"><i class="fa-solid fa-id-card"></i></div>
                <div class="idle-title">Welcome, Athlete</div>
                <div class="idle-sub">Enter your phone number on the left to check in</div>
            </div>

            <div class="profile-card" id="profile-card">
                <div class="profile-chrome">

                    <div class="profile-banner" id="profile-banner">
                        <div class="profile-banner-badge" id="profile-rank-display">RANK â€”</div>
                    </div>

                    <div class="profile-avatar-wrap">
                        <div class="profile-avatar" id="profile-avatar">?</div>
                        <div class="profile-avatar-ring" id="profile-ring"></div>
                    </div>

                    <div class="profile-body">
                        <div class="profile-name" id="profile-name">â€”</div>
                        <div class="profile-id"   id="profile-id">Member since â€”</div>

                        <div class="profile-stats">
                            <div class="stat-cell"><div class="stat-val" id="stat-level">â€”</div><div class="stat-label">Level</div></div>
                            <div class="stat-cell"><div class="stat-val" id="stat-exp">â€”</div><div class="stat-label">EXP</div></div>
                            <div class="stat-cell"><div class="stat-val" id="stat-streak">â€”</div><div class="stat-label">Streak</div></div>
                        </div>

                        <div class="xp-section">
                            <div class="xp-top">
                                <span>Experience Progress</span>
                                <span id="xp-pct-label">0%</span>
                            </div>
                            <div class="xp-track"><div class="xp-fill" id="xp-fill"></div></div>
                        </div>

                        <div class="class-badge class-none" id="class-badge">
                            <i class="fa-solid fa-star" id="class-icon"></i>
                            <span id="class-name">No Class</span>
                        </div>

                        <div class="routine-card">
                            <div class="routine-icon"><i class="fa-solid fa-dumbbell"></i></div>
                            <div>
                                <div class="routine-label">Today's Routine</div>
                                <div class="routine-name" id="routine-name">â€”</div>
                            </div>
                        </div>

                    </div>
                </div>
            </div><!-- /profile-card -->

        </div><!-- /checkin-right -->
    </div><!-- /kiosk-body -->
</div><!-- /kiosk-wrap -->

<script>
/* CLOCK */
function updateClock() {
    const now = new Date();
    document.getElementById('clock-time').textContent =
        now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
    document.getElementById('clock-date').textContent =
        now.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
}
updateClock(); setInterval(updateClock, 10000);

/* STATE */
let step = 'number', phoneNumber = '', pinValue = '', submitting = false;
let autoResetTimer = null;

const CLASS_ICONS = { Warrior:'fa-shield', Ranger:'fa-bullseye', Tank:'fa-anchor', Assassin:'fa-eye', Mage:'fa-wand-sparkles' };
const BANNER_COLORS = {
    Warrior: 'linear-gradient(135deg,#7f1d1d,#ef4444)',
    Ranger:  'linear-gradient(135deg,#064e3b,#10b981)',
    Tank:    'linear-gradient(135deg,#1e3a8a,#3b82f6)',
    Assassin:'linear-gradient(135deg,#3b0764,#a855f7)',
    Mage:    'linear-gradient(135deg,#78350f,#fbbf24)',
};

/* DOM */
const flipCard      = document.getElementById('flip-card');
const displayNum    = document.getElementById('display-number');
const displayText   = document.getElementById('display-number-text');
const hintNum       = document.getElementById('hint-number');
const hintPin       = document.getElementById('hint-pin');
const pinSpinner    = document.getElementById('pin-spinner');
const confirmedState= document.getElementById('confirmed-state');
const confirmedMsg  = document.getElementById('confirmed-msg');
const idleState     = document.getElementById('idle-state');
const profileCard   = document.getElementById('profile-card');
const checkinRight  = document.getElementById('checkin-right');

/* KEYS */
document.querySelectorAll('.numpad-key[data-val]').forEach(key => {
    key.addEventListener('click', () => {
        key.classList.add('ripple');
        setTimeout(() => key.classList.remove('ripple'), 400);
        if (key.dataset.step !== step) return;
        if (step === 'number') handleNumberKey(key.dataset.val);
        else if (step === 'pin') handlePinKey(key.dataset.val);
    });
});
document.getElementById('proceed-btn').addEventListener('click', proceedToPin);
document.getElementById('new-checkin-btn').addEventListener('click', resetAll);

/* NUMBER STEP */
function handleNumberKey(val) {
    if (val === 'clear') phoneNumber = '';
    else if (val === 'delete') phoneNumber = phoneNumber.slice(0,-1);
    else if (phoneNumber.length < 10) phoneNumber += val;
    renderNumberDisplay();
    setHint(hintNum, '\u00a0', '');
}

function renderNumberDisplay() {
    // Format as (XXX) XXX-XXXX while typing
    const raw = phoneNumber;
    let formatted = raw;
    if (raw.length > 6) formatted = `(${raw.slice(0,3)}) ${raw.slice(3,6)}-${raw.slice(6)}`;
    else if (raw.length > 3) formatted = `(${raw.slice(0,3)}) ${raw.slice(3)}`;
    else if (raw.length > 0) formatted = `(${raw}`;
    displayText.innerHTML = (formatted || '') + '<span class="cursor"></span>';
    displayNum.classList.toggle('glow', raw.length > 0);
}

function proceedToPin() {
    if (phoneNumber.length < 10) {
        setHint(hintNum, 'Please enter your 10-digit phone number', 'error');
        displayNum.classList.add('error');
        setTimeout(() => displayNum.classList.remove('error'), 600);
        return;
    }
    step = 'pin'; pinValue = '';
    flipCard.classList.add('flipped');
    // Show masked phone on PIN screen
    document.getElementById('pin-member-hint').textContent = `(${phoneNumber.slice(0,3)}) ${phoneNumber.slice(3,6)}-${phoneNumber.slice(6)}`;
    updateStepDots(2);
    renderPinDots();
    setHint(hintPin, '\u00a0', '');
}

/* PIN STEP */
function handlePinKey(val) {
    if (submitting) return;
    if (val === 'back') { flipBack(); return; }
    if (val === 'delete') pinValue = pinValue.slice(0,-1);
    else if (pinValue.length < 4) pinValue += val;
    renderPinDots();
    setHint(hintPin, '\u00a0', '');
    if (pinValue.length === 4) setTimeout(submitCheckin, 150);
}

function renderPinDots() {
    for (let i=0;i<4;i++) {
        const d = document.getElementById(`pd-${i}`);
        d.classList.toggle('filled', i < pinValue.length);
        d.classList.remove('error');
    }
}

function flipBack() {
    step = 'number'; pinValue = '';
    flipCard.classList.remove('flipped');
    updateStepDots(1);
}

/* SUBMIT */
async function submitCheckin() {
    if (submitting) return;
    submitting = true;
    pinSpinner.classList.add('visible');
    try {
        const res = await fetch('/api/kiosk/checkin', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ phone_number: phoneNumber, pin: pinValue })
        });
        const data = await res.json();
        if (data.success) showSuccess(data);
        else showError(data.message || 'Invalid PIN. Try again.');
    } catch(e) {
        showError('Connection error. Please try again.');
    } finally {
        submitting = false;
        pinSpinner.classList.remove('visible');
    }
}

/* SUCCESS */
function showSuccess(data) {
    updateStepDots(3);
    document.getElementById('flip-scene').style.display = 'none';
    confirmedMsg.textContent = `Welcome back, ${data.first_name}! Have a great workout ðŸ’ª`;
    confirmedState.classList.add('visible');
    fillProfile(data);
    idleState.classList.add('hidden');
    checkinRight.classList.add('lit');
    setTimeout(() => profileCard.classList.add('visible'), 100);
    clearTimeout(autoResetTimer);
    autoResetTimer = setTimeout(resetAll, 30000);
}

function fillProfile(data) {
    document.getElementById('profile-avatar').textContent = (data.full_name||'?')[0].toUpperCase();
    document.getElementById('profile-name').textContent   = data.full_name;
    document.getElementById('profile-id').textContent     = data.registration_date ? `Member since ${data.registration_date}` : 'LevelUP Member';
    document.getElementById('stat-level').textContent     = `Lv.${data.level}`;
    document.getElementById('stat-exp').textContent       = (data.current_exp||0).toLocaleString();
    document.getElementById('stat-streak').textContent    = `${data.streak||0}ðŸ”¥`;

    const pct = Math.min(data.xp_pct||0, 100);
    document.getElementById('xp-pct-label').textContent = pct + '%';
    setTimeout(() => { document.getElementById('xp-fill').style.width = pct + '%'; }, 300);

    const rank = data.rank || 'E';
    document.getElementById('profile-rank-display').textContent = `RANK ${rank}`;

    const cls = data.client_class;
    const badge = document.getElementById('class-badge');
    badge.className = `class-badge ${cls ? 'class-'+cls : 'class-none'}`;
    document.getElementById('class-icon').className = `fa-solid ${cls && CLASS_ICONS[cls] ? CLASS_ICONS[cls] : 'fa-star'}`;
    document.getElementById('class-name').textContent = cls || 'No Class Yet';
    document.getElementById('profile-ring').className = `profile-avatar-ring ${cls ? 'ring-'+cls : ''}`;

    document.getElementById('routine-name').textContent = data.routine_name || 'Rest Day â€” No routine scheduled';
    document.getElementById('routine-name').style.fontStyle = data.routine_name ? '' : 'italic';

    document.getElementById('profile-banner').style.background =
        cls && BANNER_COLORS[cls] ? BANNER_COLORS[cls] : 'linear-gradient(135deg,var(--accent),var(--accent-2))';
}

/* ERROR */
function showError(msg) {
    setHint(hintPin, msg, 'error');
    for (let i=0;i<pinValue.length;i++) document.getElementById(`pd-${i}`).classList.add('error');
    pinValue = '';
    setTimeout(renderPinDots, 800);
}

/* RESET */
function resetAll() {
    clearTimeout(autoResetTimer);
    step='number'; phoneNumber=''; pinValue=''; submitting=false;
    flipCard.classList.remove('flipped');
    document.getElementById('flip-scene').style.display='';
    confirmedState.classList.remove('visible');
    renderNumberDisplay(); renderPinDots();
    setHint(hintNum,'\u00a0',''); setHint(hintPin,'\u00a0','');
    updateStepDots(1);
    profileCard.classList.remove('visible');
    checkinRight.classList.remove('lit');
    document.getElementById('xp-fill').style.width='0%';
    setTimeout(() => idleState.classList.remove('hidden'), 300);
}

/* HELPERS */
function setHint(el, text, cls) { el.textContent=text; el.className='numpad-hint'+(cls?' '+cls:''); }
function updateStepDots(active) {
    for(let i=1;i<=3;i++){
        const d=document.getElementById(`dot-step-${i}`);
        d.classList.remove('active','done');
        if(i<active) d.classList.add('done');
        else if(i===active) d.classList.add('active');
    }
}

/* KEYBOARD */
document.addEventListener('keydown', e => {
    if (step==='number') {
        if(e.key>='0'&&e.key<='9') handleNumberKey(e.key);
        else if(e.key==='Backspace') handleNumberKey('delete');
        else if(e.key==='Enter') proceedToPin();
    } else if (step==='pin') {
        if(e.key>='0'&&e.key<='9') handlePinKey(e.key);
        else if(e.key==='Backspace') handlePinKey('delete');
        else if(e.key==='Escape') flipBack();
    }
});

renderNumberDisplay();
</script>
</body>
</html>